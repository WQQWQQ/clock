angular.module("starter",["ionic","controllers","services","directives"]).run(function($ionicPlatform,$location,$state){$ionicPlatform.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),"/tab/clock"!=$location.$$path&&window.setTimeout(function(){$state.go("tab.clock")},50)})}).config(function($stateProvider,$urlRouterProvider,$ionicConfigProvider){$ionicConfigProvider.tabs.position("bottom"),$ionicConfigProvider.tabs.style("standard"),$ionicConfigProvider.navBar.alignTitle("center"),$ionicConfigProvider.views.transition("ios"),$ionicConfigProvider.form.checkbox("ios"),$ionicConfigProvider.form.toggle("ios"),$ionicConfigProvider.spinner.icon("ios-small"),$ionicConfigProvider.views.forwardCache(!0),$ionicConfigProvider.backButton.previousTitleText(!0),$ionicConfigProvider.backButton.text(""),$ionicConfigProvider.templates.maxPrefetch(20),$ionicConfigProvider.views.swipeBackEnabled(!1),$ionicConfigProvider.scrolling.jsScrolling(!0),$urlRouterProvider.otherwise("/tab/clock"),$stateProvider.state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.clock",{cache:!1,url:"/clock",views:{"tab-clock":{templateUrl:"templates/tab-clock.html",controller:"ClockCtrl"}}}).state("tab.new-clock",{cache:!1,url:"/new-clock",params:{list:null},views:{"tab-clock":{templateUrl:"templates/new-clock.html",controller:"NewClockCtrl"}}}).state("tab.world",{cache:!1,url:"/world",views:{"tab-world":{templateUrl:"templates/tab-world.html",controller:"WorldCtrl"}}}).state("tab.new-world",{cache:!1,url:"/new-world",views:{"tab-world":{templateUrl:"templates/new-world.html",controller:"NewWorldCtrl"}}}).state("tab.hourglass",{cache:!0,url:"/hourglass",views:{"tab-hourglass":{templateUrl:"templates/tab-hourglass.html",controller:"HourglassCtrl"}}}).state("tab.stopwatch",{cache:!0,url:"/stopwatch",views:{"tab-stopwatch":{templateUrl:"templates/tab-stopwatch.html",controller:"StopwatchCtrl"}}})}).controller("IndexCtrl",function($scope,$state){$scope.go=function(state,param){$state.go(state,param)},$scope.week=[{id:0,name:"日",select:!1},{id:1,name:"一",select:!1},{id:2,name:"二",select:!1},{id:3,name:"三",select:!1},{id:4,name:"四",select:!1},{id:5,name:"五",select:!1},{id:6,name:"六",select:!1}]}),angular.module("controllers",[]).controller("ClockCtrl",function($scope,$state,$ionicTabsDelegate,$storage,$ionicActionSheet,$timeout,$rootScope){$timeout(function(){$ionicTabsDelegate.showBar(!0),$rootScope.hideTabs=""},20),$storage.get("qq-clock-clockArr")&&($scope.clockList=$storage.get("qq-clock-clockArr"),console.log($scope.clockList)),$scope.$on("$ionicView.beforeLeave",function(e){$rootScope.hideTabs="tabs-item-hide",$ionicTabsDelegate.showBar(!1)}),$scope.showActionSheet=function(index,list){var sheet=$ionicActionSheet.show({buttons:[{text:"编辑"}],destructiveText:"删除",titleText:"编辑闹钟",cancelText:"取消",destructiveButtonClicked:function(){$scope.clockList.splice(index,1),$storage.set("qq-clock-clockArr",JSON.stringify($scope.clockList)),sheet()},buttonClicked:function(index){switch(index){case 0:$state.go("tab.new-clock",{list:list})}}});$timeout(function(){sheet()},2e3)}}).controller("NewClockCtrl",function($scope,$location,$ionicTabsDelegate,$convert,$ionicModal,$calculateTime,$interval,$ionicHistory,$storage,$stateParams){function checkTime(){if($scope.param.week.length>0){var setDay,today=(new Date).getDay();$scope.param.week[0]<today?setDay=$scope.param.week[0]+7-today:$scope.param.week[0]>today?setDay=$scope.param.week[0]-today:($scope.mydate.setDate((new Date).getDate()),setDay=$scope.mydate.getTime()-(new Date).getTime()<6e4?7:0),$scope.mydate.setDate((new Date).getDate()+setDay)}else $scope.mydate.setDate((new Date).getDate()),$scope.mydate.getTime()-(new Date).getTime()<0&&$scope.mydate.setDate((new Date).getDate()+1);var obj=$calculateTime.minus(new Date,$scope.mydate);$scope.day=obj.day,$scope.hour=obj.hour,$scope.minute=obj.minute}$scope.clockType=["旋律","震动","旋律和震动"];var interval;interval=$interval(function(){checkTime()},2e3),$scope.mydate=new Date,$scope.mydate.setDate((new Date).getDate()+1),$scope.day=1,$scope.isNight=!0,$stateParams.list?($scope.viewTitle="编辑闹钟",$scope.param=$stateParams.list):($scope.viewTitle="新建闹钟",$scope.param={clockName:"闹钟",hour:$convert.convert((new Date).getHours()),minute:$convert.convert((new Date).getMinutes()),repeat:!1,week:[],type:$scope.clockType[0],music:null,volume:50,on:!0}),$scope.addHour=function(num){24==$convert.convert(Number(num)+1)?($scope.param.hour="00",$scope.mydate.setHours(0)):($scope.param.hour=$convert.convert(Number(num)+1),$scope.mydate.setHours(Number(num)+1)),checkTime()},$scope.minusHour=function(num){$convert.convert(Number(num)-1)==-1||Number(num)==-1?($scope.param.hour="23",$scope.mydate.setHours(23)):($scope.param.hour=$convert.convert(Number(num)-1),$scope.mydate.setHours(Number(num)-1)),checkTime()},$scope.addMinute=function(num){60==$convert.convert(Number(num)+1)?($scope.param.minute="00",$scope.mydate.setMinutes(0)):($scope.param.minute=$convert.convert(Number(num)+1),$scope.mydate.setMinutes(Number(num)+1)),checkTime()},$scope.minusMinute=function(num){$convert.convert(Number(num)-1)==-1||Number(num)==-1?($scope.param.minute="59",$scope.mydate.setMinutes(59)):($scope.param.minute=$convert.convert(Number(num)-1),$scope.mydate.setMinutes(Number(num)-1)),checkTime()},$scope.timeKeyDown=function($event,num,type){$event.keyCode>47&&58>$event.keyCode&&num.toString().length<2||8==$event.keyCode||46==$event.keyCode?"hour"==type?num>2?8!=$event.keyCode&&46!=$event.keyCode&&$event.preventDefault():2==num&&$event.keyCode>51&&$event.preventDefault():num>5&&8!=$event.keyCode&&46!=$event.keyCode&&$event.preventDefault():$event.preventDefault()},$scope.timeKeyUp=function(){checkTime()},$scope.timeBlur=function(num,type){num||("hour"==type?($scope.param.hour=$convert.convert((new Date).getHours()),$scope.mydate.setHours(Number($scope.param.hour))):($scope.param.minute=$convert.convert((new Date).getMinutes()),$scope.mydate.setMinutes(Number($scope.param.minute))),checkTime())},$scope.weekDayClick=function(day){day.select=!day.select,day.select?$scope.param.week.push(day.id):$scope.param.week.splice($scope.param.week.indexOf(day.id),1);for(var leftArr=[],rightArr=[],today=(new Date).getDay(),i=0,len=$scope.param.week.length;i<len;i++)$scope.param.week[i]>today?leftArr.push($scope.param.week[i]):$scope.param.week[i]<today&&rightArr.push($scope.param.week[i]);$scope.param.week=$scope.param.week.indexOf(today)!=-1?$convert.sort(leftArr).concat($convert.sort(rightArr),today):$convert.sort(leftArr).concat($convert.sort(rightArr)),checkTime()},$scope.goListModal=function(type){$ionicModal.fromTemplateUrl("templates/list-modal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal,$scope.modal.show(),"type"==type?($scope.modalTitle="闹钟类型",$scope.modalList=$scope.clockType):$scope.modalTitle="闹钟铃声"})},$scope.closeModal=function(){$scope.modal.remove()},$scope.saveClock=function(){if(0==$scope.param.week.length&&$scope.param.week.push($scope.mydate.getDay()),$storage.get("qq-clock-clockArr")){var clockArr=$storage.get("qq-clock-clockArr");clockArr.unshift($scope.param),$storage.set("qq-clock-clockArr",clockArr)}else{var arr=[];arr.unshift($scope.param),$storage.set("qq-clock-clockArr",arr)}console.log($storage.get("qq-clock-clockArr")),$ionicHistory.goBack()},$scope.$on("$ionicView.beforeLeave",function(){$ionicTabsDelegate.showBar(!0),$interval.cancel(interval)})}).controller("WorldCtrl",function($scope,$ionicTabsDelegate,$storage,$convert,$interval,$ionicActionSheet,$timeout,$rootScope){function getCountryTime(){for(var i=0,len=$scope.countryList.length;i<len;i++){var date=new Date;date.setHours(date.getUTCHours()+Number($scope.countryList[i].diff)),$scope.countryList[i].currTime=$convert.convert(date.getHours())+":"+$convert.convert(date.getMinutes()),$scope.countryList[i].currDate=$convert.convert(date.getMonth()+1)+"月"+$convert.convert(date.getDate())+"日  周"+$scope.week[date.getDay()].name}}var interval;$timeout(function(){$ionicTabsDelegate.showBar(!0),$rootScope.hideTabs=""},20),$storage.get("qq-clock-countryArr")&&($scope.countryList=$storage.get("qq-clock-countryArr"),getCountryTime()),interval=$interval(function(){getCountryTime()},2e3),$scope.showActionSheet=function(index,list){var sheet=$ionicActionSheet.show({destructiveText:"删除",titleText:list.name,cancelText:"取消",destructiveButtonClicked:function(){$scope.countryList.splice(index,1),$storage.set("qq-clock-countryArr",JSON.stringify($scope.countryList)),sheet()}});$timeout(function(){sheet()},2e3)},$scope.$on("$ionicView.beforeLeave",function(){$rootScope.hideTabs="tabs-item-hide",$ionicTabsDelegate.showBar(!1),$interval.cancel(interval)})}).controller("NewWorldCtrl",function($scope,$ionicTabsDelegate,$ionicHistory,$storage,$ionicLoading,$timeout){$scope.countryList=[{id:0,name:"北京 / 中国",diff:"+8"},{id:1,name:"纽约 / 美国",diff:"-5"},{id:2,name:"伦敦 / 英国",diff:"+0"},{id:3,name:"悉尼 / 澳大利亚",diff:"+10"},{id:4,name:"东京 / 日本",diff:"+9"},{id:5,name:"洛杉矶 / 美国",diff:"-8"},{id:6,name:"莫斯科 / 俄罗斯",diff:"+4"},{id:7,name:"里约热内卢 / 巴西",diff:"-3"}],$scope.select=function(list){if($storage.get("qq-clock-countryArr")){for(var countryArr=$storage.get("qq-clock-countryArr"),exist=!1,i=0,len=countryArr.length;i<len;i++)if(list.id==countryArr[i].id){exist=!0,$ionicLoading.show({template:list.name+"已存在"}).then(function(){$timeout(function(){$ionicLoading.hide()},1500)});break}exist||(countryArr.unshift(list),$storage.set("qq-clock-countryArr",countryArr),$ionicHistory.goBack())}else{var arr=[];arr.unshift(list),$storage.set("qq-clock-countryArr",arr),$ionicHistory.goBack()}},$scope.$on("$ionicView.beforeEnter",function(e){$ionicTabsDelegate.showBar(!1)}),$scope.$on("$ionicView.beforeLeave",function(){$ionicTabsDelegate.showBar(!0)})}).controller("HourglassCtrl",function($scope,$convert,$interval,$ionicTabsDelegate,$ionicPlatform){$ionicPlatform.ready(function(){function checkIsForbid(time){$scope.isForbid="00"==time.hour&&"00"==time.minute&&"00"==time.second}function count(){var s=Number($scope.time.second),m=Number($scope.time.minute),h=Number($scope.time.hour);interval=$interval(function(){if(0==s)if(m>0)s=60,m--;else{if(!(h>0))return $ionicTabsDelegate.showBar(!1),$scope.isTime=!0,$scope.status=0,$interval.cancel(interval),duration=media.getDuration(),alert(duration),intervals=$interval(function(){media.play(),navigator.vibrate([1e3*duration]),media.setVolume("1.0")},duration+1e3),void($scope.isStart=!1);s=60,m=59,h--}s--,$scope.time.hour=$convert.convert(h),$scope.time.minute=$convert.convert(m),$scope.time.second=$convert.convert(s)},1e3)}var media,duration,getPathMedia=function(){var path=window.location.pathname,phoneGapPath=path.substring(0,path.lastIndexOf("/")+1);return"file://"+phoneGapPath};media=new Media(getPathMedia()+"audio/ring1.mp3",function(){});var interval,intervals;$scope.start=function($event){$scope.isForbid?$event.preventDefault():($scope.status=1,$scope.startTime=$scope.time.hour+":"+$scope.time.minute+":"+$scope.time.second,count())},$scope.timeKeyDown=function($event,num,type){$event.keyCode>47&&58>$event.keyCode&&num.toString().length<2||8==$event.keyCode||46==$event.keyCode?"hour"==type?num>2?8!=$event.keyCode&&46!=$event.keyCode&&$event.preventDefault():2==num&&$event.keyCode>51&&$event.preventDefault():num>5&&8!=$event.keyCode&&46!=$event.keyCode&&$event.preventDefault():$event.preventDefault()},$scope.timeKeyUp=function(){checkIsForbid($scope.time)},$scope.timeBlur=function(num,type){num||($scope.time[type]="00"),$scope.time[type]=$convert.convert(num),checkIsForbid($scope.time)},$scope.stop=function(){$scope.status=2,$interval.cancel(interval)},$scope.restart=function(){$scope.status=1,count()},$scope.reset=function(){$scope.isForbid=!0,$scope.status=0,$scope.time={hour:"00",minute:"00",second:"00"},$interval.cancel(interval)},$scope.reset(),$scope.close=function(){$ionicTabsDelegate.showBar(!0),$scope.isTime=!1,$interval.cancel(intervals),media.stop(),navigator.vibrate([0]),media.release()}})}).controller("StopwatchCtrl",function($scope,$timeout,$convert,$ionicScrollDelegate){function count(){startMS++,$scope.time.hour=$convert.convert(Math.floor(startMS/36e4)),$scope.time.minute=$convert.convert(Math.floor(startMS/6e3)),$scope.time.second=$convert.convert(Math.floor(startMS/100)),$scope.time.mSecond=$convert.convert(startMS%100),timeout=$timeout(function(){count()},10)}var startMS,timeout;$scope.reset=function(){$ionicScrollDelegate.scrollTop(!0),$scope.status=0,$scope.timeList=[],startMS=0,timeout=null,$scope.time={hour:"00",minute:"00",second:"00",mSecond:"00"}},$scope.reset(),$scope.start=function(){$scope.status=1,count()},$scope.stop=function(){$scope.status=2,$timeout.cancel(timeout)},$scope.count=function(){var obj={hour:$scope.time.hour,minute:$scope.time.minute,second:$scope.time.second,mSecond:$scope.time.mSecond};obj.currTime=obj.hour+":"+obj.minute+":"+obj.second+":"+obj.mSecond;var curr=36e4*Number(obj.hour)+6e3*Number(obj.minute)+100*Number(obj.second)+Number(obj.mSecond),len=$scope.timeList.length;if(len>0){var lastCurr=36e4*Number($scope.timeList[0].hour)+6e3*Number($scope.timeList[0].minute)+100*Number($scope.timeList[0].second)+Number($scope.timeList[0].mSecond),gap=curr-lastCurr,hour=Math.floor(gap/36e4),minute=Math.floor((gap-36e3*hour)/6e3),second=Math.floor((gap-36e3*hour-600*minute)/100),mSecond=gap-36e4*hour-6e3*minute-100*second;obj.gapTime=$convert.convert(hour)+":"+$convert.convert(minute)+":"+$convert.convert(second)+":"+$convert.convert(mSecond)}else obj.gapTime=obj.currTime;$scope.timeList.unshift(obj),$scope.timeList[0].index=$convert.convert($scope.timeList.length)}}),angular.module("directives",[]).directive("hideTabs",function($rootScope){return{restrict:"AE",link:function($scope){$rootScope.hideTabs="tabs-item-hide",$scope.$on("$destroy",function(){$rootScope.hideTabs=""})}}}).directive("headerBack",function($scope){return{restrict:"E",link:function($scope){}}}),angular.module("services",[]).factory("$convert",function(){return{convert:function(num){var nums="number"==typeof num?num.toString():num;return 1==nums.length?"0"+nums:nums},sort:function(arr){if(arr instanceof Array&&arr.length>1){for(var cIndex=Math.floor(arr.length/2),leftArr=[],rightArr=[],cEle=arr.splice(cIndex,1)[0],i=0,len=arr.length;i<len;i++)arr[i]<=cEle?leftArr.push(arr[i]):rightArr.push(arr[i]);return arguments.callee(leftArr).concat(cEle,arguments.callee(rightArr))}return arr}}}).factory("$calculateTime",function(){return{minus:function(currD,setD){var times=setD.getTime()-currD.getTime(),totalMinutes=Math.ceil(times/6e4),day=Math.floor(totalMinutes/1440),hour=Math.floor((totalMinutes-1440*day)/60),minute=totalMinutes-1440*day-60*hour;return{day:day,hour:hour,minute:minute}}}}).factory("$storage",function(){return{s:window.localStorage,get:function(key){return JSON.parse(this.s.getItem(key))},set:function(key,val){"object"==typeof val?this.s.setItem(key,JSON.stringify(val)):this.s.setItem(key,val)},remove:function(key){this.s.removeItem(key)},clear:function(){this.s.clear()}}});